<!-- notes.html (All Notes, dark iOS style) -->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>All Notes</title>
  <link rel="stylesheet" th:href="@{/css/styles.css}" href="/css/styles.css" />
  <link rel="stylesheet" th:href="@{/css/auth.css}" href="/css/auth.css" />
  <style>
    .page-center{min-height:100dvh;display:grid;place-items:center;padding:clamp(12px,3vw,32px)}
    .section.narrow{max-width:900px;width:100%}
    #notes-list .note{
      padding:12px;border:1px solid var(--ios-separator);border-radius:12px;
      background:var(--ios-card); color:var(--ios-text); margin-bottom:10px;
    }
    .muted{ color:var(--ios-subtext) }
  </style>
</head>
<body class="bg-grad-peach">
<main class="page-center">
  <section class="section narrow">
    <h2 style="text-align:center">All Notes</h2>
    <div id="notes-list"></div>
    <div style="margin-top:12px;text-align:center">
      <a th:href="@{/}" href="/index.html" class="stylish-btn" data-variant="gray">‚Üê Back to Main</a>
    </div>
  </section>
</main>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const notesList = document.getElementById("notes-list");
    if (!notesList) return;
    const noteDate = new URLSearchParams(window.location.search).get('date');
    if (noteDate) { fetchNotesForDate(noteDate); } else { fetchNotesFromBackend(); }
  });

  function renderNotes(arr){
    const notesList = document.getElementById("notes-list");
    if (!arr || arr.length === 0){
      notesList.innerHTML = "<p class='muted'>No notes available.</p>";
      return;
    }
    notesList.innerHTML = "";
    arr.forEach(note=>{
      const formattedDate = new Date(note.date).toLocaleDateString('en-US', {
        weekday:'long', year:'numeric', month:'long', day:'numeric'
      });
      const noteDiv = document.createElement("div");
      noteDiv.className = "note";
      noteDiv.innerHTML = `<p><strong>${formattedDate}</strong></p><p>${(note.content||'').replace(/\n/g,'<br/>')}</p>`;
      notesList.appendChild(noteDiv);
    });
  }

  function fetchNotesFromBackend() {
    fetch("/user/notes")
      .then(r=>r.json())
      .then(renderNotes)
      .catch(error => console.error("Error fetching notes:", error));
  }

  function fetchNotesForDate(date) {
    fetch(`/user/notes?date=${encodeURIComponent(date)}`)
      .then(r=>r.json())
      .then(data=>{
        const arr = Array.isArray(data) ? data : (data ? [data] : []);
        renderNotes(arr);
      })
      .catch(error => console.error("Error fetching notes:", error));
  }
</script>
</body>
</html>
