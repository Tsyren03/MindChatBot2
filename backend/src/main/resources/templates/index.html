<!-- backend/src/main/resources/templates/index.html -->
<!DOCTYPE html>
<html th:lang="${#locale}" lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title th:text="#{app.title}">Mental Health Support</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <link rel="stylesheet" th:href="@{/css/styles.css}" href="/css/styles.css">
    <!-- Utility class for JS-driven visibility -->
    <style>.hidden{display:none!important}</style>
</head>
<body class="theme-sketch">
<nav class="lang-switch" role="navigation" aria-label="Language">
    <a th:href="@{/index(lang='en')}" th:classappend="${#locale.language}=='en' ? ' active' : ''">EN</a>
    <a th:href="@{/index(lang='ko')}" th:classappend="${#locale.language}=='ko' ? ' active' : ''">ÌïúÍµ≠Ïñ¥</a>
    <a th:href="@{/index(lang='ru')}" th:classappend="${#locale.language}=='ru' ? ' active' : ''">RU</a>
</nav>

<!-- Optional mobile tabs (JS activates automatically if present) -->
<nav id="mobile-tabs" class="hidden" role="tablist" aria-label="Sections">
    <button class="mobile-tab stylish-btn" data-tab="mood" aria-selected="true" type="button">Mood</button>
    <button class="mobile-tab stylish-btn" data-tab="journal" aria-selected="false" type="button">Journal</button>
    <button class="mobile-tab stylish-btn" data-tab="chat" aria-selected="false" type="button">Chat</button>
</nav>

<main class="container three-column-layout">
    <!-- Mood Tracker -->
    <section id="mood-tracker" class="section mood-tracker" aria-labelledby="mood-tracker-title">
        <h2 id="mood-tracker-title" th:text="#{mood.tracker}">Mood Tracker</h2>
        <div class="today-date" id="current-date" th:text="#{mood.today} + ' '">Today:</div>

        <div class="calendar-controls">
            <button class="stylish-btn" id="prev-month" aria-label="Previous month" type="button">‚óÄ</button>
            <span id="current-month" data-year="" data-month="">‚Äî</span>
            <button class="stylish-btn" id="next-month" aria-label="Next month" type="button">‚ñ∂</button>
        </div>

        <div class="calendar-responsive-wrapper">
            <div class="calendar">
                <div class="calendar-weekdays">
                    <span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span><span class="sunday">Sun</span>
                </div>
                <div id="calendar" aria-label="Monthly calendar"></div>
            </div>
        </div>

        <div id="emotion-buttons" class="emotion-buttons one-row">
            <button class="mood-btn bad"     type="button" onclick="showSubMoodButtons('bad')">üòû <span th:text="#{mood.bad}">Bad</span></button>
            <button class="mood-btn poor"    type="button" onclick="showSubMoodButtons('poor')">üòï <span th:text="#{mood.poor}">Poor</span></button>
            <button class="mood-btn neutral" type="button" onclick="showSubMoodButtons('neutral')">üòê <span th:text="#{mood.neutral}">Neutral</span></button>
            <button class="mood-btn good"    type="button" onclick="showSubMoodButtons('good')">üôÇ <span th:text="#{mood.good}">Good</span></button>
            <button class="mood-btn best"    type="button" onclick="showSubMoodButtons('best')">üòÉ <span th:text="#{mood.best}">Best</span></button>
        </div>

        <div id="submood-buttons-container">
            <div id="submood-buttons" class="submood-buttons">
                <button class="submood-btn" type="button" data-code="proud"        th:text="#{mood.sub.proud}">Proud</button>
                <button class="submood-btn" type="button" data-code="grateful"     th:text="#{mood.sub.grateful}">Grateful</button>
                <button class="submood-btn" type="button" data-code="energetic"    th:text="#{mood.sub.energetic}">Energetic</button>
                <button class="submood-btn" type="button" data-code="excited"      th:text="#{mood.sub.excited}">Excited</button>
                <button class="submood-btn" type="button" data-code="fulfilled"    th:text="#{mood.sub.fulfilled}">Fulfilled</button>
                <button class="submood-btn" type="button" data-code="calm"         th:text="#{mood.sub.calm}">Calm</button>
                <button class="submood-btn" type="button" data-code="productive"   th:text="#{mood.sub.productive}">Productive</button>
                <button class="submood-btn" type="button" data-code="hopeful"      th:text="#{mood.sub.hopeful}">Hopeful</button>
                <button class="submood-btn" type="button" data-code="motivated"    th:text="#{mood.sub.motivated}">Motivated</button>
                <button class="submood-btn" type="button" data-code="friendly"     th:text="#{mood.sub.friendly}">Friendly</button>
                <button class="submood-btn" type="button" data-code="indifferent"  th:text="#{mood.sub.indifferent}">Indifferent</button>
                <button class="submood-btn" type="button" data-code="blank"        th:text="#{mood.sub.blank}">Blank</button>
                <button class="submood-btn" type="button" data-code="tired"        th:text="#{mood.sub.tired}">Tired</button>
                <button class="submood-btn" type="button" data-code="bored"        th:text="#{mood.sub.bored}">Bored</button>
                <button class="submood-btn" type="button" data-code="quiet"        th:text="#{mood.sub.quiet}">Quiet</button>
                <button class="submood-btn" type="button" data-code="frustrated"   th:text="#{mood.sub.frustrated}">Frustrated</button>
                <button class="submood-btn" type="button" data-code="overwhelmed"  th:text="#{mood.sub.overwhelmed}">Overwhelmed</button>
                <button class="submood-btn" type="button" data-code="nervous"      th:text="#{mood.sub.nervous}">Nervous</button>
                <button class="submood-btn" type="button" data-code="insecure"     th:text="#{mood.sub.insecure}">Insecure</button>
                <button class="submood-btn" type="button" data-code="confused"     th:text="#{mood.sub.confused}">Confused</button>
                <button class="submood-btn" type="button" data-code="angry"        th:text="#{mood.sub.angry}">Angry</button>
                <button class="submood-btn" type="button" data-code="sad"          th:text="#{mood.sub.sad}">Sad</button>
                <button class="submood-btn" type="button" data-code="lonely"       th:text="#{mood.sub.lonely}">Lonely</button>
                <button class="submood-btn" type="button" data-code="anxious"      th:text="#{mood.sub.anxious}">Anxious</button>
                <button class="submood-btn" type="button" data-code="hopeless"     th:text="#{mood.sub.hopeless}">Hopeless</button>
            </div>
        </div>

        <div class="note">
            <a th:href="@{/statistics(lang=${#locale.language})}" class="stylish-btn" data-variant="gray" th:text="#{nav.viewStats}">üìä View Mood Statistics</a>
        </div>
    </section>

    <!-- Journaling -->
    <section id="journaling" class="section journaling" aria-labelledby="journaling-title">
        <h2 id="journaling-title" th:text="#{journaling.title}">Journaling</h2>
        <form id="new-note-form" novalidate>
            <textarea id="note-content" name="content" required th:placeholder="#{journaling.placeholder}" placeholder="Write your note here..."></textarea>
            <label for="note-date" th:text="#{journaling.date}">Date:</label>
            <input type="date" id="note-date" name="date" required />
            <button type="submit" class="stylish-btn" data-variant="accent" th:text="#{journaling.save}">Save Note</button>
        </form>
        <div class="note">
            <a th:href="@{/notes(lang=${#locale.language})}" class="stylish-btn" data-variant="gray" th:text="#{nav.viewAllNotes}">View all notes</a>
        </div>
    </section>

    <!-- Chat -->
    <section id="chat-section" class="section chat-section" aria-labelledby="chat-section-title">
        <h2 id="chat-section-title" th:text="#{chat.title}">Mind Chat Bot</h2>
        <div class="chat-box" id="chat-box">
            <div class="messages" id="messages"
                 role="log" aria-live="polite" aria-relevant="additions text"></div>
            <div class="input-area">
                <input type="text" id="user-input" th:placeholder="#{chat.inputPlaceholder}" placeholder="Type a message..." autocomplete="off">
                <button id="send-btn" type="button" class="stylish-btn" data-variant="accent" th:text="#{chat.send}">Send</button>
            </div>
            <div class="chat-actions">
                <form th:action="@{/logout}" method="post">
                    <button type="submit" class="stylish-btn" data-variant="gray" th:text="#{buttons.logout}">Logout</button>
                </form>
                <a th:href="@{/home(lang=${#locale.language})}" class="stylish-btn" data-variant="accent" th:text="#{buttons.profile}">My Profile</a>
            </div>
        </div>
    </section>
</main>

<!-- 1) Inject ALL submood labels into window.I18N BEFORE app script executes -->
<script th:inline="javascript">
    window.I18N = Object.assign({}, window.I18N || {}, {
      'mood.sub.proud':       /*[[#{mood.sub.proud}]]*/       'Proud',
      'mood.sub.grateful':    /*[[#{mood.sub.grateful}]]*/    'Grateful',
      'mood.sub.energetic':   /*[[#{mood.sub.energetic}]]*/   'Energetic',
      'mood.sub.excited':     /*[[#{mood.sub.excited}]]*/     'Excited',
      'mood.sub.fulfilled':   /*[[#{mood.sub.fulfilled}]]*/   'Fulfilled',
      'mood.sub.calm':        /*[[#{mood.sub.calm}]]*/        'Calm',
      'mood.sub.productive':  /*[[#{mood.sub.productive}]]*/  'Productive',
      'mood.sub.hopeful':     /*[[#{mood.sub.hopeful}]]*/     'Hopeful',
      'mood.sub.motivated':   /*[[#{mood.sub.motivated}]]*/   'Motivated',
      'mood.sub.friendly':    /*[[#{mood.sub.friendly}]]*/    'Friendly',
      'mood.sub.indifferent': /*[[#{mood.sub.indifferent}]]*/ 'Indifferent',
      'mood.sub.blank':       /*[[#{mood.sub.blank}]]*/       'Blank',
      'mood.sub.tired':       /*[[#{mood.sub.tired}]]*/       'Tired',
      'mood.sub.bored':       /*[[#{mood.sub.bored}]]*/       'Bored',
      'mood.sub.quiet':       /*[[#{mood.sub.quiet}]]*/       'Quiet',
      'mood.sub.frustrated':  /*[[#{mood.sub.frustrated}]]*/  'Frustrated',
      'mood.sub.overwhelmed': /*[[#{mood.sub.overwhelmed}]]*/ 'Overwhelmed',
      'mood.sub.nervous':     /*[[#{mood.sub.nervous}]]*/     'Nervous',
      'mood.sub.insecure':    /*[[#{mood.sub.insecure}]]*/    'Insecure',
      'mood.sub.confused':    /*[[#{mood.sub.confused}]]*/    'Confused',
      'mood.sub.angry':       /*[[#{mood.sub.angry}]]*/       'Angry',
      'mood.sub.sad':         /*[[#{mood.sub.sad}]]*/         'Sad',
      'mood.sub.lonely':      /*[[#{mood.sub.lonely}]]*/      'Lonely',
      'mood.sub.anxious':     /*[[#{mood.sub.anxious}]]*/     'Anxious',
      'mood.sub.hopeless':    /*[[#{mood.sub.hopeless}]]*/    'Hopeless'
    });
</script>

<!-- 2) Load app script -->
<script th:src="@{/js/script.js?v=9}" src="/js/script.js?v=9" defer></script>

<!-- 3) Relabel SSR buttons on first load + colorize submood buttons (locale-agnostic by data-code) -->
<script defer>
    document.addEventListener('DOMContentLoaded', () => {
      const labels = window.I18N || {};
      document.querySelectorAll('#submood-buttons [data-code]').forEach(btn => {
        const code = btn.dataset.code;
        const lbl = labels['mood.sub.' + code];
        if (lbl) btn.textContent = lbl;
        btn.classList.add('submood-btn');
      });

      if (window.showSubMoodButtons) {
        const _orig = window.showSubMoodButtons;
        window.showSubMoodButtons = function (mainMood) {
          _orig(mainMood);
          const colorMap = (window.MOOD_COLOR_MAP || {})[mainMood] || {};
          document.querySelectorAll('#submood-buttons [data-code]').forEach(b => {
            const code = b.dataset.code;
            const color = colorMap[code];
            if (color) {
              b.style.background = color;          /* color allowed for submoods */
              b.style.color = '#fff';
              b.style.borderColor = 'rgba(0,0,0,.15)';
            } else {
              b.style.background = '';
              b.style.color = '';
              b.style.borderColor = '';
            }
          });
        };
      }
    });
</script>
</body>
</html>
